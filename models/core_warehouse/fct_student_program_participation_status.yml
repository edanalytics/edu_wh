version: 1

models: 
  - name: fct_student_program_participation_status
    description: >
     ##### Overview:
       This fact table provides student program participation statuses, received as part of a program enrollment.
       It references any or all of the following models:
      - [stg_ef3__stu_spec_ed__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_spec_ed__program_participation_statuses)
      - [stg_ef3__stu_lang_instr__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_lang_instr__program_participation_statuses)
      - [stg_ef3__stu_homeless__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_homeless__program_participation_statuses)
      - [stg_ef3__stu_title_i__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_title_i__program_participation_statuses)
      - [stg_ef3__stu_cte__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_cte__program_participation_statuses)
      - [stg_ef3__stu_migrant_edu__program_participation_statusess](#!/model/model.edu_edfi_source.stg_ef3__stu_migrant_edu__program_participation_statuses)
      - [stg_ef3__stu_school_food_service__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_school_food_service__program_participation_statuses)
      - [stg_ef3__stu_program__program_participation_statuses](#!/model/model.edu_edfi_source.stg_ef3__stu_program__program_participation_statuses)

     ##### Primary Key:
       `k_student_program, participation_status, status_begin_date` --
       There is one record per student, year, program, ed org, program start date, program participation status, and status begin date.

     ##### Important business rules:
        - `program_enroll_begin_date` is included in the unique key, because a student may be associated with the same program at multiple times,
           and those associations may have different program participation statuses. When joining this table to `fct_student_{program_type}_program_association`,
           always include `program_enroll_begin_date` in the join.

    config:
      tags: ['special_ed', 'homeless', 'language_instruction', 'title_i', 'cte', 'migrant_education', 'food_service']
      enabled: >
        {%- set var_values = [] -%}
        {%- for variable in [
             'src:program:special_ed:enabled',
             'src:program:homeless:enabled',
             'src:program:language_instruction:enabled',
             'src:program:title_i:enabled',
             'src:program:cte:enabled',
             'src:program:migrant_education:enabled',
             'src:program:food_service:enabled'
        ] -%}
           {%- do var_values.append(var(variable, none)) -%}
        {%- endfor -%}

        {%- if True in var_values -%}
           {{ True  | as_bool }}
        {%- elif False in var_values -%}
           {{ False | as_bool }}
        {%- else -%}
           {{ True  | as_bool }}
        {%- endif -%}
        
    columns:
      - name: k_student_program
      - name: k_student
      - name: k_program
      - name: tenant_code
      - name: ed_org_id
      - name: program_enroll_begin_date
      - name: participation_status
      - name: status_begin_date
      - name: status_end_date
      - name: designated_by
